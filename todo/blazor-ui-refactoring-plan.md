# Blazor UI 重构计划

## 项目概述
- **创建日期**: 2025-07-23
- **目标**: 提升MoLibrary UI模块的代码复用率、样式一致性、质量和可维护性
- **涉及模块**: MoLibrary.UI, MoLibrary.FrameworkUI

## 当前进度追踪

### ✅ 已完成任务
- [x] 分析 MoLibrary.UI 模块结构和实现模式
- [x] 分析 MoLibrary.FrameworkUI 模块结构和实现模式  
- [x] 审查两个模块中的CSS和样式模式
- [x] 识别当前问题和改进机会
- [x] 创建全面的重构计划和最佳实践

### 📋 待执行阶段

#### Phase 1: 建立基础架构（第1-2周）
- [ ] 创建统一的样式系统
  - [ ] 创建 `MoLibrary.UI/Styles/` 目录结构
  - [ ] 定义CSS变量系统 (`_variables.css`)
  - [ ] 创建基础样式重置 (`_base.css`)
  - [ ] 建立组件通用样式 (`_components.css`)
  - [ ] 整合主题样式 (`mo-theme.css`)
- [ ] 创建通用组件库
  - [ ] 创建 `MoLibrary.UI/Components/Common/` 目录
  - [ ] 实现 `MoCard.razor` 统一卡片组件
  - [ ] 实现 `MoLoadingState.razor` 加载状态组件
  - [ ] 实现 `MoErrorBoundary.razor` 错误边界组件
  - [ ] 实现 `MoDataGrid.razor` 增强数据网格
  - [ ] 实现 `MoFormField.razor` 表单字段包装器
  - [ ] 创建 `IMoSnackbar` 接口和 `MoSnackbar` 组件封装

#### Phase 2: 重构现有组件（第3-4周）
- [ ] 建立组件层次结构
  - [ ] 定义基础组件接口和基类
  - [ ] 重构业务组件以使用基础组件
  - [ ] 优化页面组件结构
- [ ] 提取公共模式
  - [ ] 创建 `MoComponentBase` 基类
  - [ ] 实现通用的加载/错误处理模式
  - [ ] 统一组件参数和事件处理
- [ ] 清理重复的CSS定义
  - [ ] 移除重复的 `.modern-card` 定义
  - [ ] 统一使用CSS变量
  - [ ] 建立组件特定样式的命名规范

#### Phase 3: 统一服务层架构（第5周）
- [ ] 服务层规范化
  - [ ] 确保所有服务方法返回 `Res<T>` 类型
  - [ ] 统一错误处理模式（try-catch返回Res.Fail）
  - [ ] 规范服务方法命名和参数
- [ ] 重构现有服务（排除SignalRDebugService）
  - [ ] 更新其他服务以遵循新规范
  - [ ] 确保异常捕获和错误返回
  - [ ] 优化服务依赖注入

#### Phase 4: 实施最佳实践（第6周）
- [ ] 优化组件生命周期
  - [ ] 移动初始化逻辑到 `OnAfterRenderAsync`
  - [ ] 实现取消令牌模式
  - [ ] 添加适当的资源清理
- [ ] 实现状态管理模式
  - [ ] 创建状态容器类
  - [ ] 实现状态变更通知
  - [ ] 优化组件间通信

#### Phase 5: 文档和示例（第7周）
- [ ] 创建开发指南
  - [ ] 组件开发最佳实践文档
  - [ ] 样式使用指南
  - [ ] 服务层架构文档
- [ ] 创建示例代码
  - [ ] 基础组件使用示例
  - [ ] 复杂场景示例
  - [ ] 性能优化示例

## 关键问题跟踪

### 🔴 高优先级问题
1. **CSS管理不统一**: 样式定义重复，缺少全局变量
2. **组件复用性不足**: 缺少通用基础组件库
3. **生命周期使用不当**: 初始化逻辑可能导致页面阻塞

### 🟡 中优先级问题
1. **服务层架构不一致**: 部分直接使用服务，部分通过Controller
2. **缺少统一的错误处理**: 错误处理方式不一致
3. **状态管理分散**: 缺少集中的状态管理模式

### 🟢 低优先级问题
1. **缺少性能监控**: 没有组件渲染性能追踪
2. **文档不完整**: 缺少详细的开发指南

## 决策记录

### 2025-07-23
- **决策**: 采用直接重构策略，直接替换现有实现
- **理由**: 提高开发效率，快速达到目标架构
- **影响**: 需要一次性完成相关模块的重构
- **特殊说明**: SignalRDebugService因其特殊性（需要保留WebSocket JSON通信调试功能）不进行重构

## 注意事项

1. **代码审查**: 每个阶段完成后进行代码审查
2. **文档更新**: 同步更新相关文档
3. **及时提交**: 完成每个小任务后及时提交代码

## 相关文档
- UI模块规则: `/rules/ui/blazor-ui-best-practices.md`
- 组件开发指南: `/rules/ui/component-development-guide.md`
- 样式系统规范: `/rules/ui/styling-guidelines.md`

## 更新历史
- 2025-07-23: 初始计划创建