@using Microsoft.Extensions.Options
@using MoLibrary.UI.Modules
@using MoLibrary.UI.UICore
@using MoLibrary.UI.UICore.Interfaces
@using MoLibrary.UI.Services
@using MoLibrary.UI.Components.Layout
@inherits LayoutComponentBase
@inject IUIComponentRegistry UIRegistry
@inject IOptions<ModuleUICoreOption> Options
@inject MoThemeService ThemeService
@implements IDisposable

<MoThemeProvider>
    <MudPopoverProvider />
    <MudDialogProvider />
    <MudSnackbarProvider />
    
    <div class="mo-main-container @GetMainContainerClass()">
        <!-- å·¦ä¾§å›ºå®šå¯¼èˆªæ å¡ç‰‡ -->
        <div class="mo-sidebar-container">
            <MudPaper Class="mo-sidebar-card" Elevation="3">
                <MoSidebar @bind-IsExpanded="_sidebarExpanded" />
            </MudPaper>
        </div>
        
        <!-- å³ä¾§å†…å®¹å¡ç‰‡ -->
        <div class="mo-content-container @GetContentContainerClass()">
            <MudPaper Class="mo-content-card" Elevation="2">
                @Body
            </MudPaper>
        </div>
    </div>
</MoThemeProvider>


<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">ðŸ—™</span>
</div>

@code {
    private bool _sidebarExpanded = true;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        ThemeService.OnThemeChanged += StateHasChanged;
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= StateHasChanged;
    }

    private string GetMainContainerClass()
    {
        return _sidebarExpanded ? "sidebar-expanded" : "sidebar-collapsed";
    }

    private string GetContentContainerClass()
    {
        return _sidebarExpanded ? "content-with-expanded-sidebar" : "content-with-collapsed-sidebar";
    }
}


